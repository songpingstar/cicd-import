{
    "instance_id": "CTFd__CTFd-2797",
    "patch": "diff --git a/CTFd/utils/exports/__init__.py b/CTFd/utils/exports/__init__.py\nindex ef1f3000b8..83286e974f 100644\n--- a/CTFd/utils/exports/__init__.py\n+++ b/CTFd/utils/exports/__init__.py\n@@ -365,10 +365,12 @@ def insertion(table_filenames):\n \n                         try:\n                             table.insert(entry)\n-                        except ProgrammingError:\n+                        except (ProgrammingError, TypeError):\n                             # MariaDB does not like JSON objects and prefers strings because it internally\n                             # represents JSON with LONGTEXT.\n                             # See Issue #973\n+                            # We also catch TypeError here so that PyMySQL can properly send over JSON strings to MariaDB\n+                            # https://github.com/PyMySQL/PyMySQL/commit/521e40050cb386a499f68f483fefd144c493053c\n                             requirements = entry.get(\"requirements\")\n                             if requirements and isinstance(requirements, dict):\n                                 entry[\"requirements\"] = json.dumps(requirements)\ndiff --git a/requirements.in b/requirements.in\nindex 3543fddd5b..95bdcc7a17 100644\n--- a/requirements.in\n+++ b/requirements.in\n@@ -1,23 +1,23 @@\n-Flask==2.0.3\n-Werkzeug==2.0.3\n+Flask==2.1.3\n+Werkzeug==2.2.3\n jinja2==3.1.6\n Flask-SQLAlchemy==2.5.1\n-Flask-Caching==2.0.2\n+Flask-Caching==2.3.1\n Flask-Migrate==2.5.3\n Flask-Script==2.0.6\n-SQLAlchemy==1.4.48\n+SQLAlchemy==1.4.54\n SQLAlchemy-Utils==0.41.1\n passlib==1.7.4\n bcrypt==4.0.1\n requests==2.32.4\n-PyMySQL[rsa]==1.0.2\n+PyMySQL[rsa]==1.1.1\n gunicorn==23.0.0\n dataset==1.6.2\n-cmarkgfm==2024.1.14\n+cmarkgfm==2024.11.20\n redis==4.5.5\n-gevent==23.9.1\n+gevent==25.5.1\n python-dotenv==0.13.0\n-flask-restx==1.1.0\n+flask-restx==1.3.0\n flask-marshmallow==0.10.1\n marshmallow-sqlalchemy==0.17.0\n boto3==1.35.27\n@@ -26,11 +26,11 @@ pydantic==1.6.2\n WTForms==2.3.1\n python-geoacumen-city==2023.4.15\n maxminddb==1.5.4\n-tenacity==6.2.0\n+tenacity==9.1.2\n nh3==0.3.0\n-freezegun==1.2.2\n+freezegun==1.5.5\n Flask-Babel==2.0.0\n-Pillow==10.1.0\n+Pillow==11.3.0\n cffi==1.17.1\n-six==1.16.0\n-urllib3==1.26.20\n+six==1.17.0\n+urllib3==2.5.0\ndiff --git a/requirements.txt b/requirements.txt\nindex 758d62059d..3207f700fd 100644\n--- a/requirements.txt\n+++ b/requirements.txt\n@@ -4,15 +4,17 @@\n #\n #    ./scripts/pip-compile.sh\n #\n-alembic==1.4.3\n+alembic==1.16.4\n     # via\n     #   dataset\n     #   flask-migrate\n-aniso8601==8.0.0\n+aniso8601==10.0.1\n     # via flask-restx\n-attrs==20.3.0\n-    # via jsonschema\n-babel==2.12.1\n+attrs==25.3.0\n+    # via\n+    #   jsonschema\n+    #   referencing\n+babel==2.17.0\n     # via flask-babel\n banal==1.0.6\n     # via dataset\n@@ -20,30 +22,30 @@ bcrypt==4.0.1\n     # via -r requirements.in\n boto3==1.35.27\n     # via -r requirements.in\n-botocore==1.35.27\n+botocore==1.35.99\n     # via\n     #   boto3\n     #   s3transfer\n cachelib==0.9.0\n     # via flask-caching\n-certifi==2024.7.4\n+certifi==2025.8.3\n     # via requests\n cffi==1.17.1\n     # via\n     #   -r requirements.in\n     #   cmarkgfm\n     #   cryptography\n-charset-normalizer==2.0.12\n+charset-normalizer==3.4.3\n     # via requests\n-click==7.1.2\n+click==8.2.1\n     # via flask\n-cmarkgfm==2024.1.14\n+cmarkgfm==2024.11.20\n     # via -r requirements.in\n-cryptography==40.0.2\n+cryptography==45.0.6\n     # via pymysql\n dataset==1.6.2\n     # via -r requirements.in\n-flask==2.0.3\n+flask==2.1.3\n     # via\n     #   -r requirements.in\n     #   flask-babel\n@@ -55,13 +57,13 @@ flask==2.0.3\n     #   flask-sqlalchemy\n flask-babel==2.0.0\n     # via -r requirements.in\n-flask-caching==2.0.2\n+flask-caching==2.3.1\n     # via -r requirements.in\n flask-marshmallow==0.10.1\n     # via -r requirements.in\n flask-migrate==2.5.3\n     # via -r requirements.in\n-flask-restx==1.1.0\n+flask-restx==1.3.0\n     # via -r requirements.in\n flask-script==2.0.6\n     # via -r requirements.in\n@@ -69,37 +71,42 @@ flask-sqlalchemy==2.5.1\n     # via\n     #   -r requirements.in\n     #   flask-migrate\n-freezegun==1.2.2\n+freezegun==1.5.5\n     # via -r requirements.in\n-gevent==23.9.1\n+gevent==25.5.1\n     # via -r requirements.in\n-greenlet==3.0.3\n+greenlet==3.2.4\n     # via\n     #   gevent\n     #   sqlalchemy\n gunicorn==23.0.0\n     # via -r requirements.in\n-idna==2.10\n+idna==3.10\n     # via requests\n-itsdangerous==2.1.2\n+importlib-resources==6.5.2\n+    # via flask-restx\n+itsdangerous==2.2.0\n     # via flask\n jinja2==3.1.6\n     # via\n     #   -r requirements.in\n     #   flask\n     #   flask-babel\n-jmespath==0.10.0\n+jmespath==1.0.1\n     # via\n     #   boto3\n     #   botocore\n-jsonschema==3.2.0\n+jsonschema==4.25.0\n     # via flask-restx\n-mako==1.1.3\n+jsonschema-specifications==2025.4.1\n+    # via jsonschema\n+mako==1.3.10\n     # via alembic\n-markupsafe==2.1.3\n+markupsafe==3.0.2\n     # via\n     #   jinja2\n     #   mako\n+    #   werkzeug\n     #   wtforms\n marshmallow==2.20.2\n     # via\n@@ -114,51 +121,52 @@ maxminddb==1.5.4\n     #   python-geoacumen-city\n nh3==0.3.0\n     # via -r requirements.in\n-packaging==24.2\n+packaging==25.0\n     # via gunicorn\n passlib==1.7.4\n     # via -r requirements.in\n-pillow==10.1.0\n+pillow==11.3.0\n     # via -r requirements.in\n-pycparser==2.20\n+pycparser==2.22\n     # via cffi\n pydantic==1.6.2\n     # via -r requirements.in\n-pymysql[rsa]==1.0.2\n+pymysql[rsa]==1.1.1\n     # via\n     #   -r requirements.in\n     #   pymysql\n-pyrsistent==0.17.3\n-    # via jsonschema\n-python-dateutil==2.8.1\n+python-dateutil==2.9.0.post0\n     # via\n-    #   alembic\n     #   botocore\n     #   freezegun\n python-dotenv==0.13.0\n     # via -r requirements.in\n-python-editor==1.0.4\n-    # via alembic\n python-geoacumen-city==2023.4.15\n     # via -r requirements.in\n-pytz==2020.4\n+pytz==2025.2\n     # via\n     #   flask-babel\n     #   flask-restx\n redis==4.5.5\n     # via -r requirements.in\n+referencing==0.36.2\n+    # via\n+    #   jsonschema\n+    #   jsonschema-specifications\n requests==2.32.4\n     # via -r requirements.in\n-s3transfer==0.10.0\n+rpds-py==0.27.0\n+    # via\n+    #   jsonschema\n+    #   referencing\n+s3transfer==0.10.4\n     # via boto3\n six==1.16.0\n     # via\n     #   -r requirements.in\n     #   flask-marshmallow\n-    #   jsonschema\n     #   python-dateutil\n-    #   tenacity\n-sqlalchemy==1.4.48\n+sqlalchemy==1.4.54\n     # via\n     #   -r requirements.in\n     #   alembic\n@@ -168,23 +176,27 @@ sqlalchemy==1.4.48\n     #   sqlalchemy-utils\n sqlalchemy-utils==0.41.1\n     # via -r requirements.in\n-tenacity==6.2.0\n+tenacity==9.1.2\n     # via -r requirements.in\n-urllib3==1.26.20\n+typing-extensions==4.14.1\n+    # via\n+    #   alembic\n+    #   referencing\n+urllib3==2.5.0\n     # via\n     #   -r requirements.in\n     #   botocore\n     #   requests\n-werkzeug==2.0.3\n+werkzeug==2.2.3\n     # via\n     #   -r requirements.in\n     #   flask\n     #   flask-restx\n wtforms==2.3.1\n     # via -r requirements.in\n-zope-event==4.5.0\n+zope-event==5.1.1\n     # via gevent\n-zope-interface==5.2.0\n+zope-interface==7.2\n     # via gevent\n \n # The following packages are considered to be unsafe in a requirements file:\n",
    "repo": "CTFd/CTFd",
    "base_commit": "e1f342b1624e66cd30f5963dba85af39008ff5d9",
    "hints_text": "Just hasn't been updated yet. However you can run things with Docker and it should run.",
    "created_at": "2025-08-10T22:14:50Z",
    "test_patch": "diff --git a/tests/admin/test_views.py b/tests/admin/test_views.py\nindex 2a9c75adbb..a8cc739734 100644\n--- a/tests/admin/test_views.py\n+++ b/tests/admin/test_views.py\n@@ -59,7 +59,7 @@ def test_admin_access():\n         for route in routes:\n             r = client.get(route)\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/login\")\n+            assert r.location.startswith(\"/login\")\n \n         admin = login_as_user(app, name=\"admin\")\n         routes.remove(\"/admin\")\n@@ -78,5 +78,5 @@ def test_get_admin_as_user():\n         client = login_as_user(app)\n         r = client.get(\"/admin\")\n         assert r.status_code == 302\n-        assert r.location.startswith(\"http://localhost/login\")\n+        assert r.location.startswith(\"/login\")\n     destroy_ctfd(app)\ndiff --git a/tests/api/v1/user/test_admin_access.py b/tests/api/v1/user/test_admin_access.py\nindex fb7120856b..da28f4689c 100644\n--- a/tests/api/v1/user/test_admin_access.py\n+++ b/tests/api/v1/user/test_admin_access.py\n@@ -44,5 +44,5 @@ def test_api_hint_404():\n         for endpoint in endpoints:\n             r = client.get(endpoint.format(1))\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/login\")\n+            assert r.location.startswith(\"/login\")\n     destroy_ctfd(app)\ndiff --git a/tests/oauth/test_redirect.py b/tests/oauth/test_redirect.py\nindex 488aea012c..f54fa90f5b 100644\n--- a/tests/oauth/test_redirect.py\n+++ b/tests/oauth/test_redirect.py\n@@ -18,7 +18,7 @@ def test_oauth_not_configured():\n     with app.app_context():\n         with app.test_client() as client:\n             r = client.get(\"/oauth\", follow_redirects=False)\n-            assert r.location == \"http://localhost/login\"\n+            assert r.location == \"/login\"\n             r = client.get(r.location)\n             resp = r.get_data(as_text=True)\n             assert \"OAuth Settings not configured\" in resp\ndiff --git a/tests/teams/test_challenges.py b/tests/teams/test_challenges.py\nindex 7ee305f6cc..6e73617ef0 100644\n--- a/tests/teams/test_challenges.py\n+++ b/tests/teams/test_challenges.py\n@@ -51,7 +51,7 @@ def test_anonymous_users_view_public_challenges_without_team():\n         with app.test_client() as client:\n             r = client.get(\"/challenges\")\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/login\")\n+            assert r.location.startswith(\"/login\")\n \n         set_config(\"challenge_visibility\", \"public\")\n         with app.test_client() as client:\n@@ -61,5 +61,5 @@ def test_anonymous_users_view_public_challenges_without_team():\n         with login_as_user(app) as client:\n             r = client.get(\"/challenges\")\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/team\")\n+            assert r.location.startswith(\"/team\")\n     destroy_ctfd(app)\ndiff --git a/tests/test_themes.py b/tests/test_themes.py\nindex 57c7bf2d9d..112b597d60 100644\n--- a/tests/test_themes.py\n+++ b/tests/test_themes.py\n@@ -90,7 +90,7 @@ def test_that_ctfd_can_be_deployed_in_subdir():\n         with app.test_client() as client:\n             r = client.get(\"/\")\n             assert r.status_code == 302\n-            assert r.location == \"http://localhost/ctf/setup\"\n+            assert r.location == \"/ctf/setup\"\n \n             r = client.get(\"/setup\")\n             with client.session_transaction() as sess:\n@@ -105,13 +105,13 @@ def test_that_ctfd_can_be_deployed_in_subdir():\n                 }\n             r = client.post(\"/setup\", data=data)\n             assert r.status_code == 302\n-            assert r.location == \"http://localhost/ctf/\"\n+            assert r.location == \"/ctf/\"\n \n             c = Client(app)\n             response = c.get(\"/\")\n             headers = dict(response.headers)\n             assert response.status == \"302 FOUND\"\n-            assert headers[\"Location\"] == \"http://localhost/ctf/\"\n+            assert headers[\"Location\"] == \"/ctf/?\"\n \n             r = client.get(\"/challenges\")\n             assert r.status_code == 200\ndiff --git a/tests/test_views.py b/tests/test_views.py\nindex 0407318852..ac6f453766 100644\n--- a/tests/test_views.py\n+++ b/tests/test_views.py\n@@ -83,7 +83,7 @@ def test_page_requiring_auth():\n         with app.test_client() as client:\n             r = client.get(\"/this-is-a-route\")\n             assert r.status_code == 302\n-            assert r.location == \"http://localhost/login?next=%2Fthis-is-a-route%3F\"\n+            assert r.location == \"/login?next=%2Fthis-is-a-route%3F\"\n \n         register_user(app)\n         client = login_as_user(app)\ndiff --git a/tests/users/test_auth.py b/tests/users/test_auth.py\nindex c29a0d2681..108c91443c 100644\n--- a/tests/users/test_auth.py\n+++ b/tests/users/test_auth.py\n@@ -141,9 +141,7 @@ def test_user_bad_login():\n         with client.session_transaction() as sess:\n             assert sess.get(\"id\") is None\n         r = client.get(\"/profile\")\n-        assert r.location.startswith(\n-            \"http://localhost/login\"\n-        )  # We got redirected to login\n+        assert r.location.startswith(\"/login\")  # We got redirected to login\n     destroy_ctfd(app)\n \n \n@@ -154,9 +152,7 @@ def test_user_login():\n         register_user(app)\n         client = login_as_user(app)\n         r = client.get(\"/profile\")\n-        assert (\n-            r.location != \"http://localhost/login\"\n-        )  # We didn't get redirected to login\n+        assert r.location is None  # We didn't get redirected to login\n         assert r.status_code == 200\n     destroy_ctfd(app)\n \n@@ -168,9 +164,7 @@ def test_user_login_with_email():\n         register_user(app)\n         client = login_as_user(app, name=\"user@examplectf.com\", password=\"password\")\n         r = client.get(\"/profile\")\n-        assert (\n-            r.location != \"http://localhost/login\"\n-        )  # We didn't get redirected to login\n+        assert r.location is None  # We didn't get redirected to login\n         assert r.status_code == 200\n     destroy_ctfd(app)\n \n@@ -183,7 +177,7 @@ def test_user_get_logout():\n         client = login_as_user(app)\n         client.get(\"/logout\", follow_redirects=True)\n         r = client.get(\"/challenges\")\n-        assert r.location == \"http://localhost/login?next=%2Fchallenges%3F\"\n+        assert r.location == \"/login?next=%2Fchallenges%3F\"\n         assert r.status_code == 302\n     destroy_ctfd(app)\n \n@@ -204,7 +198,7 @@ def test_user_isnt_admin():\n             \"config\",\n         ]:\n             r = client.get(\"/admin/{}\".format(page))\n-            assert r.location.startswith(\"http://localhost/login?next=\")\n+            assert r.location.startswith(\"/login?next=\")\n             assert r.status_code == 302\n     destroy_ctfd(app)\n \n@@ -347,7 +341,7 @@ def test_user_can_confirm_email(mock_smtp):\n \n         client = login_as_user(app, name=\"user1\", password=\"password\")\n \n-        r = client.get(\"http://localhost/confirm\")\n+        r = client.get(\"/confirm\")\n         assert \"We've sent a confirmation email\" in r.get_data(as_text=True)\n \n         # smtp send message function was called\n@@ -361,21 +355,19 @@ def test_user_can_confirm_email(mock_smtp):\n             assert \"Confirmation email sent to\" in r.get_data(as_text=True)\n \n             r = client.get(\"/challenges\")\n-            assert (\n-                r.location == \"http://localhost/confirm\"\n-            )  # We got redirected to /confirm\n+            assert r.location == \"/confirm\"  # We got redirected to /confirm\n \n             r = client.get(\n                 \"http://localhost/confirm/ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"\n             )\n-            assert r.location == \"http://localhost/challenges\"\n+            assert r.location == \"/challenges\"\n \n             # The team is now verified\n             user = Users.query.filter_by(email=\"user@user.com\").first()\n             assert user.verified is True\n \n             r = client.get(\"http://localhost/confirm\")\n-            assert r.location == \"http://localhost/settings\"\n+            assert r.location == \"/settings\"\n     destroy_ctfd(app)\n \n \n@@ -513,7 +505,7 @@ def test_registration_code_required():\n             data[\"registration_code\"] = \"secret-sauce\"\n             r = client.post(\"/register\", data=data)\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/challenges\")\n+            assert r.location.startswith(\"/challenges\")\n     destroy_ctfd(app)\n \n \n@@ -543,7 +535,7 @@ def test_registration_code_allows_numeric():\n             data[\"registration_code\"] = \"1234567890\"\n             r = client.post(\"/register\", data=data)\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/challenges\")\n+            assert r.location.startswith(\"/challenges\")\n     destroy_ctfd(app)\n \n \n@@ -581,7 +573,7 @@ def test_registration_password_minimum_length():\n             data[\"password\"] = \"validpassword\"  # 13 characters, meets minimum\n             r = client.post(\"/register\", data=data)\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/challenges\")\n+            assert r.location.startswith(\"/challenges\")\n \n             # Verify user was created\n             user_count = Users.query.count()\n@@ -604,7 +596,7 @@ def test_registration_password_minimum_length():\n             # Should allow short password when minimum length is 0\n             r = client.post(\"/register\", data=data)\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/challenges\")\n+            assert r.location.startswith(\"/challenges\")\n \n             # Verify user was created\n             user_count = Users.query.count()\ndiff --git a/tests/users/test_fields.py b/tests/users/test_fields.py\nindex b118c65139..a097845a0b 100644\n--- a/tests/users/test_fields.py\n+++ b/tests/users/test_fields.py\n@@ -259,7 +259,7 @@ def test_user_needs_all_required_fields():\n \n             r = client.get(\"/challenges\")\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/settings\")\n+            assert r.location.startswith(\"/settings\")\n \n             # Populate the non-required fields\n             r = client.patch(\n@@ -277,7 +277,7 @@ def test_user_needs_all_required_fields():\n             # I should still be restricted from seeing challenges\n             r = client.get(\"/challenges\")\n             assert r.status_code == 302\n-            assert r.location.startswith(\"http://localhost/settings\")\n+            assert r.location.startswith(\"/settings\")\n \n             # I should still see all fields b/c I don't have a complete profile\n             r = client.get(\"/settings\")\ndiff --git a/tests/users/test_setup.py b/tests/users/test_setup.py\nindex 634b12e620..c033424ffd 100644\n--- a/tests/users/test_setup.py\n+++ b/tests/users/test_setup.py\n@@ -11,7 +11,7 @@ def test_ctfd_setup_redirect():\n         with app.test_client() as client:\n             r = client.get(\"/users\")\n             assert r.status_code == 302\n-            assert r.location == \"http://localhost/setup\"\n+            assert r.location == \"/setup\"\n \n             # Files in /themes load properly\n             r = client.get(\"/themes/core/static/css/main.dev.css\")\n@@ -52,5 +52,5 @@ def test_ctfd_setup_verification():\n             data[\"email\"] = \"admin@examplectf.com\"\n             r = client.post(\"/setup\", data=data)\n             assert r.status_code == 302\n-            assert r.location == \"http://localhost/\"\n+            assert r.location == \"/\"\n     destroy_ctfd(app)\ndiff --git a/tests/utils/test_sessions.py b/tests/utils/test_sessions.py\nindex 015c61d7d7..89705e877c 100644\n--- a/tests/utils/test_sessions.py\n+++ b/tests/utils/test_sessions.py\n@@ -39,7 +39,7 @@ def test_session_invalidation_on_admin_password_change():\n             r = user.get(\"/settings\")\n             # User's password was changed\n             # They should be logged out\n-            assert r.location.startswith(\"http://localhost/login\")\n+            assert r.location.startswith(\"/login\")\n             assert r.status_code == 302\n     destroy_ctfd(app)\n \n",
    "problem_statement": "Python 3.13 support?\nWhen attempting to set up a development environment using Python 3.13.3, the dependency installation fails. This appears to be caused by pinned versions of `gevent` and `pillow` in `requirements.txt` that are not compatible with this newer Python version.\n\n### Steps to Reproduce\n\n    python3.13 -m venv venv\n    source venv/bin/activate\n\n    pip install -r requirements.txt\n\n\nThe installation fails with errors during the build process for `gevent`.\n\nI was able to resolve this issue by upgrading the following packages\n\n| `gevent` | `23.9.1` | `24.10.1` | Minimum version for Python 3.13 support. |\n| `pillow` | `10.4.0` | `11.0.0` | Required for Python 3.13 compatibility. |\n| `greenlet` | `3.0.3` | `3.1.1` | Required by `gevent==24.10.1`. |\n\n*Note: For `gevent`,  `24.10.1` is the minimum required update for python 3.13. The latest version is `25.5.1`, but  a  conservative update might avoid unintended breaking changes.*\n\nSo my question is, Is there a specific reason for the currently pinned versions? To maintain support for older Python versions, or because these versions cause breaking changes?\n",
    "environment_setup_commit": "e1f342b1624e66cd30f5963dba85af39008ff5d9",
    "pr_url": "https://github.com/CTFd/CTFd/pull/2797",
    "issue_url": "https://github.com/CTFd/CTFd/issues/2764",
    "issue_numbers": [
        "2764"
    ]
}