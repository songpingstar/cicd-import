{
    "instance_id": "getpelican__pelican-3439",
    "patch": "diff --git a/docs/settings.rst b/docs/settings.rst\nindex b442451a2..72c72fb1e 100644\n--- a/docs/settings.rst\n+++ b/docs/settings.rst\n@@ -288,7 +288,14 @@ Basic settings\n \n    A list of tags for Typogrify to ignore. By default Typogrify will ignore\n    ``pre`` and ``code`` tags. This requires that Typogrify version 2.0.4 or\n-   later is installed\n+   later is installed.\n+\n+.. data:: TYPOGRIFY_OMIT_FILTERS = []\n+\n+   A list of Typogrify filters to skip. Allowed values are: ``'amp'``,\n+   ``'smartypants'``, ``'caps'``, ``'initial_quotes'``, ``'widont'``. By\n+   default, no filter is omitted (in other words, all filters get applied). This\n+   setting requires that Typogrify version 2.1.0 or later is installed.\n \n .. data:: TYPOGRIFY_DASHES = 'default'\n \ndiff --git a/pelican/readers.py b/pelican/readers.py\nindex 59aa7ca33..182194fe1 100644\n--- a/pelican/readers.py\n+++ b/pelican/readers.py\n@@ -648,11 +648,22 @@ def read_file(\n             smartypants.Attr.default |= smartypants.Attr.w\n \n             def typogrify_wrapper(text):\n-                \"\"\"Ensures ignore_tags feature is backward compatible\"\"\"\n+                \"\"\"Ensure compatibility with older versions of Typogrify.\n+\n+                The 'TYPOGRIFY_IGNORE_TAGS' and/or 'TYPOGRIFY_OMIT_FILTERS'\n+                settings will be ignored if the installed version of Typogrify\n+                doesn't have the corresponding features.\"\"\"\n                 try:\n-                    return typogrify(text, self.settings[\"TYPOGRIFY_IGNORE_TAGS\"])\n+                    return typogrify(\n+                        text,\n+                        self.settings[\"TYPOGRIFY_IGNORE_TAGS\"],\n+                        **{f: False for f in self.settings[\"TYPOGRIFY_OMIT_FILTERS\"]},\n+                    )\n                 except TypeError:\n-                    return typogrify(text)\n+                    try:\n+                        typogrify(text, self.settings[\"TYPOGRIFY_IGNORE_TAGS\"])\n+                    except TypeError:\n+                        return typogrify(text)\n \n             if content:\n                 content = typogrify_wrapper(content)\ndiff --git a/pelican/settings.py b/pelican/settings.py\nindex 69120058a..1fb0b2111 100644\n--- a/pelican/settings.py\n+++ b/pelican/settings.py\n@@ -149,6 +149,7 @@ def load_source(name: str, path: str) -> ModuleType:\n     \"ARTICLE_PERMALINK_STRUCTURE\": \"\",\n     \"TYPOGRIFY\": False,\n     \"TYPOGRIFY_IGNORE_TAGS\": [],\n+    \"TYPOGRIFY_OMIT_FILTERS\": [],\n     \"TYPOGRIFY_DASHES\": \"default\",\n     \"SUMMARY_END_SUFFIX\": \"â€¦\",\n     \"SUMMARY_MAX_LENGTH\": 50,\n",
    "repo": "getpelican/pelican",
    "base_commit": "fa0af6d221e98386d9f1395de8928f66c238a631",
    "hints_text": "Based on a cursory glance, it seems possible to modify how Pelican invokes Typogrify (along with corresponding changes to the `TYPOGRIFY` setting) such that individual [filters](https://github.com/justinmayer/typogrify/blob/master/typogrify/filters.py) are called instead of  the all-in-one `typogrify()` filter.\r\n\r\nThat said, I imagine it would be better to make some changes to Typogrify itself in order to make it easier to apply individual filters, and/or selectively disable filters along the lines of: `typogrify(text, widont=false)`\r\n\r\nI plan to publish a new version of Typogrify in January, so if you would be willing to implement some changes to Typogrify and Pelican to enable this kind of flexibility, I would be happy to review, merge, and release new versions in an expedited manner ðŸ˜Š \nSounds good. Although each filter is available as a separate function in Typogrify, only the `typogrify()` function takes the `ignore_tags` argument. Thus, if Pelican was to call each filter separately and still have the option to ignore some tags, it looks like it would need to duplicate some of what is done in `typogrify()` (I take this from the function signatures, haven't checked the implementation yet). I agree, it makes more sense to enable this flexibility in Typogrify, then have Pelican use it. \r\n\r\nI'll look more closely at this and submit a PR against Typogrify -- not today, but hopefully before your next release!\nGreat. When you submit your PR, please do so from my fork, which is intended to replace \"upstream\" as the canonical repository: https://github.com/justinmayer/typogrify\nManaged to extend my day a little bit. :)",
    "created_at": "2024-12-27T23:15:27Z",
    "test_patch": "diff --git a/pelican/tests/test_readers.py b/pelican/tests/test_readers.py\nindex 4372fea16..751088f7a 100644\n--- a/pelican/tests/test_readers.py\n+++ b/pelican/tests/test_readers.py\n@@ -409,6 +409,90 @@ def test_typogrify_summary(self):\n         except ImportError:\n             return unittest.skip(\"need the typogrify distribution\")\n \n+    def test_typogrify_ignore_filters(self):\n+        try:\n+            # typogrify should be able to ignore user specified filters.\n+            page = self.read_file(\n+                path=\"article_with_code_block.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"amp\"],\n+            )\n+            expected = (\n+                \"<p>An article with some&nbsp;code</p>\\n\"\n+                '<div class=\"highlight\"><pre><span></span>'\n+                '<span class=\"n\">x</span>'\n+                ' <span class=\"o\">&amp;</span>'\n+                ' <span class=\"n\">y</span>\\n</pre></div>\\n'\n+                \"<p>A block&nbsp;quote:</p>\\n<blockquote>\\nx \"\n+                \"&amp; y</blockquote>\\n\"\n+                \"<p>Normal:\\nx &amp;&nbsp;y</p>\\n\"\n+            )\n+            self.assertEqual(page.content, expected)\n+\n+            page = self.read_file(\n+                path=\"article.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"smartypants\"],\n+            )\n+            expected = (\n+                '<p><span class=\"caps\">THIS</span> is some content. '\n+                \"With some stuff to&nbsp;&quot;typogrify&quot;...</p>\\n\"\n+                '<p>Now with added support for <abbr title=\"three letter '\n+                'acronym\"><span class=\"caps\">TLA</span></abbr>.</p>\\n'\n+            )\n+            self.assertEqual(page.content, expected)\n+\n+            page = self.read_file(\n+                path=\"article.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"caps\"],\n+            )\n+            expected = (\n+                \"<p>THIS is some content. \"\n+                \"With some stuff to&nbsp;&#8220;typogrify&#8221;&#8230;</p>\\n\"\n+                '<p>Now with added support for <abbr title=\"three letter '\n+                'acronym\">TLA</abbr>.</p>\\n'\n+            )\n+            self.assertEqual(page.content, expected)\n+\n+            page = self.read_file(\n+                path=\"article.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"initial_quotes\"],\n+            )\n+            expected = (\n+                '<p><span class=\"caps\">THIS</span> is some content. '\n+                \"With some stuff to&nbsp;&#8220;typogrify&#8221;&#8230;</p>\\n\"\n+                '<p>Now with added support for <abbr title=\"three letter '\n+                'acronym\"><span class=\"caps\">TLA</span></abbr>.</p>\\n'\n+            )\n+            self.assertEqual(page.content, expected)\n+\n+            page = self.read_file(\n+                path=\"article.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"widont\"],\n+            )\n+            expected = (\n+                '<p><span class=\"caps\">THIS</span> is some content. '\n+                \"With some stuff to \"\n+                \"&#8220;typogrify&#8221;&#8230;</p>\\n<p>Now with added \"\n+                'support for <abbr title=\"three letter acronym\">'\n+                '<span class=\"caps\">TLA</span></abbr>.</p>\\n'\n+            )\n+            self.assertEqual(page.content, expected)\n+\n+            page = self.read_file(\n+                path=\"article.rst\",\n+                TYPOGRIFY=True,\n+                TYPOGRIFY_OMIT_FILTERS=[\"this-filter-does-not-exists\"],\n+            )\n+            self.assertRaises(TypeError)\n+        except ImportError:\n+            return unittest.skip(\"need the typogrify distribution\")\n+        except TypeError:\n+            return unittest.skip(\"need typogrify version 2.1.0 or later\")\n+\n     def test_typogrify_ignore_tags(self):\n         try:\n             # typogrify should be able to ignore user specified tags.\n",
    "problem_statement": "Using a subset of Typogrify filters\n<!--\r\n  Hi there! Thank you for wanting to make Pelican better.\r\n\r\n  Before you submit this, letâ€™s make sure of a few things.\r\n  Please make sure the following boxes are ticked if they are correct.\r\n  If not, please try and fulfill them first. The last one is optional but encouraged.\r\n-->\r\n\r\n<!-- Checked checkbox should look like this: [x] -->\r\n- [x] I have searched the [issues](https://github.com/getpelican/pelican/issues?q=is%3Aissue) (including closed ones) and believe that this is not a duplicate.\r\n- [x] I have searched the [documentation](https://docs.getpelican.com/) and believe that my question is not covered.\r\n- [x] I am willing to lend a hand to help implement this feature. <!-- optional but encouraged -->\r\n\r\n## Feature Request\r\n<!-- Now feel free to write your idea for improvement. Thanks again ðŸ™Œ â¤ï¸ -->\r\n\r\nI appreciate using Typogrify with Pelican, but would like to disable some of the filters it provides. \r\n\r\nI'd especially like to disable the `widont` filter. That filter can sometimes cause text in narrow containers to overflow when the last two words are long, whereas the same text would wrap nicely without the non-breaking space introduced by `widont`. But the nail on `widont`'s coffin, I think, is the CSS `text-wrap` property which can do a much better job (with `balance` or `pretty`). \r\n\r\nOne filter I'd definitely want to continue using is `smartypants`.\r\n\r\nI suspect that allowing to select a list of filters might require changes to Typogrify. Any ideas on the best way to solve this? Thanks.\n",
    "environment_setup_commit": "fa0af6d221e98386d9f1395de8928f66c238a631",
    "pr_url": "https://github.com/getpelican/pelican/pull/3439",
    "issue_url": "https://github.com/getpelican/pelican/issues/3436",
    "issue_numbers": [
        "3436"
    ]
}