{
    "instance_id": "getpelican__pelican-3124",
    "patch": "diff --git a/pelican/utils.py b/pelican/utils.py\nindex f3a012176..de6ef9bfe 100644\n--- a/pelican/utils.py\n+++ b/pelican/utils.py\n@@ -155,7 +155,9 @@ def __repr__(self):\n \n     def __get__(self, obj, objtype):\n         '''Support instance methods.'''\n-        return partial(self.__call__, obj)\n+        fn = partial(self.__call__, obj)\n+        fn.cache = self.cache\n+        return fn\n \n \n def deprecated_attribute(old, new, since=None, remove=None, doc=None):\n",
    "repo": "getpelican/pelican",
    "base_commit": "86f62d0a92ad78df36aac9f5837d4f2715535421",
    "hints_text": "I did not test it but changing the `__get__` in `memoized`: https://github.com/getpelican/pelican/blob/4db5c7ca4b4903d6fbebc406f922419a6a2bb283/pelican/utils.py#L156-L158\r\nto something like:\r\n```python\r\n    def get(self, obj, objtype):\r\n        fn = partial(self.__call__, obj)\r\n        fn.cache = self.cache\r\n        return fn\r\n```\r\nshould (in theory) allow for something like\r\n\r\n```python\r\nassert some_article.content == \"foo\"\r\nsome_article._content = \"bar\"\r\nsome_article.get_content.cache.clear()\r\nassert some_article.content == \"bar\"\r\n```\nThanks for the snippet. I just gave it a quick try by modifying my local *pelican* distribution and it seems to work as intended.\n@FriedrichFroebel: Glad to hear that the suggestion from @avaris appears to address your target use case. Would you be willing to submit a pull request that implements these changes?\r\n",
    "created_at": "2023-04-24T16:47:59Z",
    "test_patch": "diff --git a/pelican/tests/test_utils.py b/pelican/tests/test_utils.py\nindex 449a68146..1890ffb96 100644\n--- a/pelican/tests/test_utils.py\n+++ b/pelican/tests/test_utils.py\n@@ -860,3 +860,34 @@ def test_pass_deep_subpaths(self):\n             utils.posixize_path(\n                 os.path.abspath(os.path.join(\"/foo/bar\", \"test\")))\n         )\n+\n+\n+class TestMemoized(unittest.TestCase):\n+    def test_memoized(self):\n+        class Container:\n+            def _get(self, key):\n+                pass\n+\n+            @utils.memoized\n+            def get(self, key):\n+                return self._get(key)\n+\n+        container = Container()\n+\n+        with unittest.mock.patch.object(\n+                container, \"_get\", side_effect=lambda x: x\n+        ) as get_mock:\n+            self.assertEqual(\"foo\", container.get(\"foo\"))\n+            get_mock.assert_called_once_with(\"foo\")\n+\n+            get_mock.reset_mock()\n+            self.assertEqual(\"foo\", container.get(\"foo\"))\n+            get_mock.assert_not_called()\n+\n+            self.assertEqual(\"bar\", container.get(\"bar\"))\n+            get_mock.assert_called_once_with(\"bar\")\n+\n+            get_mock.reset_mock()\n+            container.get.cache.clear()\n+            self.assertEqual(\"bar\", container.get(\"bar\"))\n+            get_mock.assert_called_once_with(\"bar\")\n",
    "problem_statement": "More flexible page content testing for unit tests\n- [x] I have searched the [issues](https://github.com/getpelican/pelican/issues?q=is%3Aissue) (including closed ones) and believe that this is not a duplicate.\r\n- [x] I have searched the [documentation](https://docs.getpelican.com/) and believe that my question is not covered.\r\n- [ ] I am willing to lend a hand to help implement this feature. <!-- optional but encouraged -->\r\n\r\n## Feature Request\r\n\r\nI am currently working on automated tests for a Pelican plugin. While documentation on this appears to be quite sparse and I took some of the other plugins for inspiration, especially testing the rendered page content itself seems to impose some issues for me.\r\n\r\nThe plugin will transform the source files to support custom types of blocks. To test this (and some intermediate transformation steps), I tried using `Content.content`, but this appears to be impossible for now, as this will do hard caching: https://github.com/getpelican/pelican/blob/b473280eac576705bc39b8151d27a1e05040d0e8/pelican/contents.py#L386-L396 While I could use `Content._content` as in the plugin itself, the high-level API feels much more suitable for testing purposes.\r\n\r\nFor this reason, it would be nice to somehow be able to reset the cached value of `pelican.contents.Content.get_content` (which uses `pelican.utils.memoized`) like Python allows for `functools.lru_cache` and `functools.cached_property` for example.\n",
    "environment_setup_commit": "86f62d0a92ad78df36aac9f5837d4f2715535421",
    "pr_url": "https://github.com/getpelican/pelican/pull/3124",
    "issue_url": "https://github.com/getpelican/pelican/issues/3110",
    "issue_numbers": [
        "3110"
    ]
}